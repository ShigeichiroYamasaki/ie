# インターネット工学演習 10

## ssh ログイン

## tcpdump でRIPパケットを監視する

★（sudo コマンドですが全員実行していいです）

RIP はUDPでポート番号520

```bash
sudo tcpdump port 520 -X
```

## ルーティングテーブルの変化を確認する

* 30秒ごとに確認
* ★ 192.168.0.112/28 への経路の変化を確認

```bash
ip r
```


## ネットワークの切り離し実験



### 11セグメント（16セグメント）の例（第４段階）



```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18     
--+-------+-------+-------+----+--------------------- 192.168.1.0/28
[G8R]   [G4R]   [G1R]          
  |       |       |
  |       |       ☓
  |       |     ＝＝＝＝＝＝＝＝　切り離す
  |       |       |
  |       |       17          18    19
  |       |      -+------------+-----+--------------- 192.168.1.16/28
  |       |                  [G2R]  G1 
  |       |                    |
  |       |                    |
  |       |                   33    34    35    
  |       |                 ---+-----+-----+--------- 192.168.1.32/28
  |       |                        [G3R]   G2      
  |       |                          |
  |       |                          |
  |       |                         49    50   
  |       |   -----------------------+-----+--------- 192.168.1.48/28
  |       |                               G3     
  |       |
  |       |
  |       65    66    67    
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/28
  |           [G5R]   G4    
  |             |
  |             |
  |            81          82     83
  |           --+-----------+-----+------------------ 192.168.1.80/28
  |                       [G6R]   G5  
  |                         |
  |                         |
  |                         97    98    99
  |                    -----+-----+-----+------------ 192.168.1.96/28
  |                             [G7R]  G6 
  |                               |
  |                               |
  |                              113   114  
  |                            ---+-----+------------ 192.168.1.112/28
  |                                    G7   
  |
  |
 129     130   131   
--+-------+-----+------------------------------------ 192.168.1.128/28
        [G9R]  G8     
          |
          |
         145   146   147
      ----+-----+-----+------------------------------ 192.168.1.144/28
             [G10R]   G9 
                |
                |
               161   162
            ----+-----+------------------------------ 192.168.1.160/28
                    G10
 


```


* ネットワークを物理的に切り離す
* ルーティングテーブルの自動的削除を確認する （認識に20分程度かかる！！）

```bash
ip r
```


## ネットワークの再接続実験

* 物理的に接続する
* ルーティングテーブルの自動的追加を確認

```bash
ip r
```

### ネットワークの接続変更

* 物理的に接続を変更
* IPアドレスなどの設定を変更
* ルーティングテーブルの自動的修正を確認

```bash
ip r
```


### 11セグメント（16セグメント）の例（第5段階）

G4R のeth0 のIPアドレスを 192.167.1.51/28 に変更して物理接続を変更

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2               4       1    18     
--+-------+-------+-------+----+--------------------- 192.168.1.0/28
[G8R]           [G1R]          
  |               |
  |               |
  |               17          18    19
  |              -+------------+-----+--------------- 192.168.1.16/28
  |                          [G2R]  G1 
  |                            |
  |                            |
  |                           33    34    35    
  |                         ---+-----+-----+--------- 192.168.1.32/28
  |                                [G3R]   G2      
  |                                  |
  |                                  |
  |      51                         49    50   
  |    ---+--------------------------+-----+--------- 192.168.1.48/28
  |     [G4R]                              G3     
  |       |
  |       |
  |       65    66    67    
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/28
  |           [G5R]   G4    
  |             |
  |             |
  |            81          82    83
  |           --+-----------+-----+------------------ 192.168.1.80/28
  |                       [G6R]   G5  
  |                         |
  |                         |
  |                         97    98    99
  |                    -----+-----+-----+------------ 192.168.1.96/28
  |                             [G7R]  G6 
  |                               |
  |                               |
  |                              113   114  
  |                            ---+-----+------------ 192.168.1.112/28
  |                                    G7   
  |
  |
 129     130   131   
--+-------+-----+------------------------------------ 192.168.1.128/28
        [G9R]  G8     
          |
          |
         145   146   147
      ----+-----+-----+------------------------------ 192.168.1.144/28
             [G10R]   G9 
                |
                |
               161   162
            ----+-----+------------------------------ 192.168.1.160/28
                    G10
 


```


# WEBサーバの構築


## AWS educate

https://aws.amazon.com/jp/education/awseducate/

### AWS Educate にサインイン

### AWS Account

### AWS Educate Starter Account

### AWS Console

開かないときは，ブラウザのポップアップグロックの設定を解除

### 仮想マシンの起動

### Ubuntu Server 20.04 LTS (HVM), SSD Volume Type 64ビットを選択

### 確認と作成

### 起動

### メニューから「新しいキーペアの作成」を選択

キーペア名は，自分の名前にする

### キーファイルのダウンロード

ファイルのダウンロード先は，自分のPCのホームディレクトリ

* マックの場合は，「 ダウンロード」ディレクトリあたりにファイルがダウンロードされるので，ホームディレクトリに移動させる
    * 移動させたファイルに対して，ターミナルアプリから以下のようにしてパーミッションを変更
    * 
```
      chmod 400 ファイル名　
```
      
    * 
* windowsの場合は，power shell で  pwd コマンドで表示されたパスにファイルを置く

### インスタンスが実行状態を確認

### インスタンスのチェックボックスをチェック

### 接続ボタンをクリック

### SSH クライアントのタブをクリック

ログインの例をコピーして

### ターミナルソフトを起動（ターミナル，power shell）

ssh コマンドをペーストして，AWSにログイン




## ubuntu 20.04LTS のインストール

[https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-instance-connect-set-up.html](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-instance-connect-set-up.html)

## 自分のhtml用ディレクトリを作成

```bash
cd /var/www/html

sudo mkdir ディレクトリ名（自分の学籍番号にしてください）

sudo chown 自分のアカウント:自分のアカウント ディレクトリ名

cd ディレクトリ名
```

実行例

```bash
cd /va	r/www/html

sudo mkdir 1811140000

sudo chown 1811140075a: 1811140075a 1811140075

cd 1811140075
```


## HTMLの作成

```html
<meta charset="UTF-8">
<html>
<head>
</head>
<body>
<h1>自分の名前</h1>

</body>
</html>

```


## コマンド

```bash
sudo tcpdump -Xvv -s 2048 -i eno1 rip
```


## digコマンド

* 特定のネームサーバに対してQUERYを発行する

```
$ dig A <domain> @<name server> 
```

```
dig A dns.joho.fuk.kindai.ac.jp @rs6000.cc.kindai.ac.jp
```
	
* IPアドレスからドメイン名を取得する（逆引き)

```
$ dig -x <ipaddress>
```

```
dig -x 157.13.61.6
dig -x 157.13.59.1
```

* ドメイン名に対応するMXレコードを取得する

```
$dig MX <domain>
dig MX fuk.kindai.ac.jp
```

* ルートDNSから確認を行う

```
$dig ドメイン名 +trace
```

* ルートDNSから確認を行う

```
$dig ネームサーバー soa
```

## apt-getを使ったインストール

```
sudo apt-get install パッケージ名

```

```
sudo apt-get -y install apache2 
```


### named (bind9) のインストール

```
sudo apt -y install bind9 bind9utils 

```

### bind9 の設定

* BINDのオプションを設定


/etc/bind/named.conf.options

```
sudo emacs  /etc/bind/named.conf.options
```

/etc/bind/named.conf.local 

```
sudo emacs /etc/bind/named.conf.local 
```

## ソースコードからのソフトのインストール方法

* (1)ソースコードを取得する

```
wget 　ファイルのURL 
```

* (2)圧縮されているソースコードを展開する

```
tar　コマンド
```

* (3)コンパイルの環境を整える

```
configure　スクリプト
```

* (4)コンパイルの実行

```
make コマンド
```

* (5)完成したバイナリコードをインストールする

```
sudo make install
```

## 圧縮ファイルの展開方法


* tar 形式（多数のファイルをまとめる）

	ファイルの形式が  .tar

	展開　tar xf ファイル名

* *gzip 形式　（サイズを圧縮して小さくする）

	ファイルの拡張子が　.gz 

	展開　gunzip ファイル名 

* bzip2形式（zipよりもさらにサイズが小さい）

	ファイルの拡張子が  .bz2

	展開　bunzip2 ファイル名

	tar でまとめて　gzip や bzip2で圧縮されている

*ファイルの拡張子が　　.tar.gz　　.tar.bz2

 展開　tar xfz ファイル名      tar xfj  ファイル名



