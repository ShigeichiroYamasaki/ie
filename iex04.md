# インターネット工学演習 04

## ルータの基本

### host名の設定

```
sudo hostnamectl set-hostname <ホスト名>
```

### ipfoward の設定

```
 sudo nano /etc/sysctl.conf
```


2行コメントをはずす


```
# Uncomment the next line to enable packet forwarding for IPv4
net.ipv4.ip_forward=1

# Uncomment the next line to enable packet forwarding for IPv6
#  Enabling this option disables Stateless Address Autoconfiguration
#  based on Router Advertisements for this host
net.ipv6.conf.all.forwarding=1

```

再起動

```
sudo reboot
```

### ip route コマンドの確認

```bash
ip route
```

登録

```
sudo ip r add 宛先ネットワーク/サブネット via ゲートウェアドレス  dev ネットワークインタフェス
```

### traceroute コマンド

すべてのノードの経路を調べる

```bash
traceroute IPアドレス
```

### netplanコマンドの設定ファイル

/etc/netplan/99_config.yaml

```
sudo nano /etc/netplan/99_config.yaml
```

```
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: false
      dhcp6: false
      addresses: [192.168.1.4/28]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
      routes:
      - to: 192.168.1.32/28
        via: 192.168.1.2
    eth1:
      dhcp4: false
      dhcp6: false
      addresses: [192.168.1.17/24]
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
      routes:
      - to: 192.168.1.32/28
        via: 192.168.1.18
      - to: 192.168.1.48/28
        via: 192.168.1.18
```

## ネットワーク構成図

R が付いているのがルータ

### 2セグメント(今回）

```
                          Internet
                              |
              253             1         
    -----------+--------------+---------------------------------- 192.168.0.0/24
        [ router1 ](SSH)           
               |                   
               |
               |                   
               |
  2    3   4   1  18  19  34  35  50  66  67  82  83  98  99 114 
--+----+---+---+---+---+---+---+---+---+---+---+---+---+---+---+-- 192.168.1.0/25
 G8R  G4R G1R     G2R G1  G3R G2  G3  G5R G4  G6R G5  G7R G6  G7 
  |
  |
 129  130  131  146  147  162
--+----+----+----+----+----+-------------------------------------- 192.168.1.128/25
      G9R  G8   G10R G9  G10
 
```

### 3セグメント (4セグメント）の例



```
                           Internet
                              |
              253             1         
    -----------+--------------+------------------------- 192.168.0.0/24
        [ router1 ](SSH)           
               |                   
               |
               |                   
               |
  2    3   4   1  18  19  34  35  50 
--+----+---+---+---+---+---+---+---+-------------------- 192.168.1.0/26
 G8R  G4R G1R     G2R G1  G3R G2  G3 
  |    |
  |    |
  |   65  66  67  82  83  98  99  114  
  |   -+---+---+---+---+---+---+---+-------------------- 192.168.1.64/26
  |       G5R G4  G6R G5  G7R G6  G7   
  |
  |
 129  130  131  146  147  162
--+----+----+----+----+----+---------------------------- 192.168.1.128/25
      G9R  G8   G10R G9  G10
 


```

### 6セグメント（８セグメント）の例

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18    19  
--+-------+-------+-------+----+-----+--------------- 192.168.1.0/27
[G8R]   [G4R]   [G1R]        [G2R]  G1   
  |       |                    |
  |       |                    |
  |       |                    33    34    35    50   
  |       |                 ---+-----+-----+-----+--- 192.168.1.32/27
  |       |                        [G3R]   G2    G3     
  |       |
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/27
  |           [G5R]   G4  [G6R]   G5     
  |                         |
  |                         |
  |                         97    98    99   114  
  |                    -----+-----+-----+-----+------ 192.168.1.96/27
  |                             [G7R]   G6    G7   
  |
  |
 129     130   131   146   147  
--+-------+-----+-----+-----+------------------------ 192.168.1.128/27
        [G9R]  G8  [G10R]   G9    
                     |
                     |
                    161   162
                 ----+-----+------------------------- 192.168.1.160/27
                          G10

```

### 11セグメント（16セグメント）の例

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18     
--+-------+-------+-------+----+--------------------- 192.168.1.0/28
[G8R]   [G4R]   [G1R]          
  |       |       |
  |       |       |
  |       |       17          18    19
  |       |      -+------------+-----+--------------- 192.168.16.0/28
  |       |                  [G2R]  G1 
  |       |                    |
  |       |                    |
  |       |                   33    34    35    
  |       |                 ---+-----+-----+--------- 192.168.1.32/28
  |       |                        [G3R]   G2      
  |       |                          |
  |       |                          |
  |       |                         49    50   
  |       |                      ----+-----+--------- 192.168.1.48/28
  |       |                               G3     
  |       |
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/28
  |           [G5R]   G4    
  |             |
  |             |
  |            81          82
  |           --+-----------+-----+------------------ 192.168.1.80/28
  |                       [G6R]   G5  
  |                         |
  |                         |
  |                         97    98    99
  |                    -----+-----+-----+------------ 192.168.1.96/28
  |                             [G7R]  G6 
  |                               |
  |                               |
  |                              113   114  
  |                            ---+-----+------------ 192.168.1.112/28
  |                                    G7   
  |
  |
 129     130   131   
--+-------+-----+------------------------------------ 192.168.1.128/27
        [G9R]  G8     
          |
          |
         145   146   147
      ----+-----+-----+------------------------------ 192.168.1.144/27
             [G10R]   G9 
                |
                |
               161   162
            ----+-----+------------------------------ 192.168.1.160/27
                    G10
 


```
# 従来の演習

----


* 班の3人ごとに1台のルータを配布
* ルータに電源の入力
* リセットボタンをボールペンの先で20秒程度押して設定をリセットする

## ルータの接続
### 事前の状態

* 机のハブから6台のlinux PC にLANケーブルで接続されている
* 机のハブとサーバルームからのLANケーブルが接続されている

### 変更

1. 机のハブから6台のlinux PC にLANケーブルをはずす
2. 1台のルータのLAN側ポートと3台のLinux PC をLANケーブルで接続する
3. 班ごとに机のハブから2台のルータのWANポートにLANケーブルで接続する

## linuxマシンの設定確認

* ネットワーク接続設定がDHCPでの自動接続であることを確認する
* インターネットに接続できていることを確認する


## ルータの基本設定

1. ブラウザからルータにアクセスする (192.168.11.1)
2. ユーザ名：root パスワードなしでログインする
3. 機能を確認する

### LAN設定の修正

LAN側のIPアドレスを変更してみる

### ping で確認




