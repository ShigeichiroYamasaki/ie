# インターネット工学演習 07

## linux コマンドの確認

### 現在のディレクトリのパスの確認 (pwdコマンド)

```
$ pwd
```


### ディレクトリへの移動 (cdコマンド)


```
$ cd ~
$ pwd

$ cd /
$ pwd

$ cd /usr/local
$ pwd

```

### 現在のディレクトリのファイルの一覧　(lsコマンド)

```
$ ls

```

####  ls コマンドに -l オプションをつけると詳細情報が表示される

```
$ ls -l
total 36
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 ビデオ
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 ピクチャ
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 ダウンロード
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 ミュージック
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 テンプレート
drwxr-xr-x 2 yamasaki yamasaki 4096 Jul 19  2018 ドキュメント
drwxr-xr-x 3 yamasaki yamasaki 4096 Feb 17 10:47 デスクトップ
drwxr-xr-x 7 yamasaki yamasaki 4096 Apr 17 08:30 公開

```

### IPアドレスの確認 (ip addrコマンド)

自分のIPアドレスを確認してください

```
$ ip addr

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp3s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 74:d4:35:c6:0b:b3 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.18/24 brd 192.168.0.255 scope global noprefixroute enp3s0
       valid_lft forever preferred_lft forever
    inet6 fe80::8aa6:d0ba:d83d:c568/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: wlp2s0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether 54:27:1e:9e:9f:27 brd ff:ff:ff:ff:ff:ff

```

### 新しいディレクトリの作成　（mkdirコマンド）

```
$ mkdir kadai
$ ls
ビデオ	  ダウンロード	テンプレート  デスクトップ  kadai
ピクチャ  ミュージック	ドキュメント  公開

```

### 新しいファイルの作成 (touchコマンド)

```
$ touch test
$ ls
test

```

### ファイルのコピー (cpコマンド)

```
$ cp test test1
$ ls
test  test1

```

### ファイルの移動 (mvコマンド)

```
$ mkdir work
$ ls
test  test1  work
$ mv test work
$ ls
test1  work
$ cd work/
$ ls
test

```

#### ファイル名の変更

```
$ mv test test100
$ ls
test100

```

### ファイルの削除 (rmコマンド)

```
$ ls
test100
$ rm test100 
$ ls

```


## 静的ルーティング

先週の残りは山崎が実施しました。

### 山崎の自宅マシンにsshログイン

* router1(sshサーバ) 

### 3セグメント (4セグメント）の例（第２段階）

★サブネットマスクが26ビットになっていることに注意！

```
                           Internet
                              |
              253             1         
    -----------+--------------+------------------------- 192.168.0.0/24
        [ router1 ](SSHサーバ)           
               |                   
               |
  2    3   4   1  18  19  34  35  50 
--+----+---+---+---+---+---+---+---+-------------------- 192.168.1.0/26
 G8R  G4R G1R     G2R G1  G3R G2  G3 
  |    |   |       |       |
  |    |  17      33      49 
  |    |
  |   65  66  67  82  83  98  99  114  
  |   -+---+---+---+---+---+---+---+-------------------- 192.168.1.64/26
  |       G5R G4  G6R G5  G7R G6  G7   
  |        |       |       |
  |       81      97     113   
  |
 129  130  131  146  147  162
--+----+----+----+----+----+--------------------------- 192.168.1.128/25
      G9R  G8   G10R G9  G10
       |         |
     145       161


```

### router1 のルーティングテーブルを書いてください

```
ルータ router1
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0 /24 		|				|
192.168.1.0 /26 		|				|
192.168.1.64/26			|				|
192.168.1.128/25		|				|
デフォルト   			 |				 |
```

### router1(sshサーバ) のルーティングテーブルの確認

ip route コマンドによるルーティングテーブルの確認

確認するコマンド

```
ip route
```

### G8Rのルーティングテーブルを（もう一度）書いてください

```
ルータG8R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0 /24 		|				|
192.168.1.0 /26 		|				|
192.168.1.64/26			|				|
192.168.1.128/25		|				|
デフォルト   			 |				 |
```


### G8R のルーティングテーブルの確認

ssh ログイン

```
ssh ubuntu@192.168.1.2
```

```
ip route
```

自分が書いたルーティングテーブルと比較してください

### G4R のルーティングテーブルの確認

ssh ログイン

```
ssh ubuntu@192.168.1.3
```

```
ip route
```

自分が書いたルーティングテーブルと比較してください

### デフォルトゲートウェイの変更の確認

192.168.1.64/26 のセグメントのマシン( G5R, G4, G6R, G5, G7R, G6, G7)にsshログインして確認してください。

* G5R   192.168.1.66
* G4    192.168.1.67
* G6R   192.168.1.82
* G5    192.168.1.83
* G7R   192.168.1.98
* G6    192.168.1.99
* G7    192.168.1.114


```
ssh ubuntu@IPアドレス
```

```
ip route
```



## ip route コマンドによるルーティングテーブルの追加と削除

```
sudo ip route add 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース名
```

例

```
ip route add 192.168.1.64/26 via 192.168.3 dev eth0
```

```
sudo ip route del 宛先ネットワーク/サブネット 
```

例

```
ip route add 192.168.1.64/26 
```


### 6セグメント（８セグメント）の例（第３段階）

★サブネットマスクが27ビットになっていることに注意！

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18    19  
--+-------+-------+-------+----+-----+--------------- 192.168.1.0/27
[G8R]   [G4R]   [G1R]        [G2R]  G1   
  |       |       |            |  
  |       |      17            |   
  |       |                    |
  |       |                    33    34    35    50   
  |       |                 ---+-----+-----+-----+--- 192.168.1.32/27
  |       |                        [G3R]   G2    G3     
  |       |                          |
  |       |                         49
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/27
  |           [G5R]   G4  [G6R]   G5     
  |             |           |
  |            81           |
  |                         |
  |                         97    98    99   114  
  |                    -----+-----+-----+-----+------ 192.168.1.96/27
  |                             [G7R]   G6    G7   
  |                               |
  |                             113
  |
 129     130   131   146   147  
--+-------+-----+-----+-----+------------------------ 192.168.1.128/27
        [G9R]  G8  [G10R]   G9    
          |          |
        145          |
                     |
                    161   162
                 ----+-----+------------------------- 192.168.1.160/27
                          G10
 


```

## ルーティングテーブルを書いてください（担当ルータ以外も）

* G8R
* G4R
* G2R
* G6R
* G10R

```
ルータG8R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG4R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG2R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG6R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG10R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```


## 　山崎が物理的に接続を変更します

## ルーティングテーブルが設定されていない状態でマシンにログインする方法

* まず，ルーティングが定義されているルータにssh ログインします。
* そこから直接接続されているネットワークのマシンに ssh ログインします。

### netplan のサブネット設定を修正する

#### ★　G3R, G2, G3へ ssh ログインするためには，まず G2R にssh ログインする必要があります。

#### ★　G7R, G6, G7へ ssh ログインするためには，まず G6R にssh ログインする必要があります。

#### ★　G10へ ssh ログインするためには，まず G10R にssh ログインする必要があります。


## ip route コマンドによるルーティングテーブルの確認

```
ip route
```

## ip route コマンドによるルーティングテーブルの追加

```
sudo ip route add 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース名
```

例

```
ip rroute add 192.168.0.240/28 via 192.168.226 dev enx8857ee65561c
```

### 間違っているルーティングテーブルの削除

ip route del コマンドの文法

```bash
sudo ip route del 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース
```

例

```bash
sudo ip route del 192.168.0.112/28 via 192.168.0.98 dev enx8857ee65781e
```


### 11セグメント（16セグメント）の例（第４段階）

★サブネットマスクが28ビットになっていることに注意！

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18     
--+-------+-------+-------+----+--------------------- 192.168.1.0/28
[G8R]   [G4R]   [G1R]          
  |       |       |
  |       |       |
  |       |       17          18    19
  |       |      -+------------+-----+--------------- 192.168.16.0/28
  |       |                  [G2R]  G1 
  |       |                    |
  |       |                    |
  |       |                   33    34    35    
  |       |                 ---+-----+-----+--------- 192.168.1.32/28
  |       |                        [G3R]   G2      
  |       |                          |
  |       |                          |
  |       |                         49    50   
  |       |   -----------------------+-----+--------- 192.168.1.48/28
  |       |                               G3     
  |       |
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/28
  |           [G5R]   G4    
  |             |
  |             |
  |            81          82
  |           --+-----------+-----+------------------ 192.168.1.80/28
  |                       [G6R]   G5  
  |                         |
  |                         |
  |                         97    98    99
  |                    -----+-----+-----+------------ 192.168.1.96/28
  |                             [G7R]  G6 
  |                               |
  |                               |
  |                              113   114  
  |                            ---+-----+------------ 192.168.1.112/28
  |                                    G7   
  |
  |
 129     130   131   
--+-------+-----+------------------------------------ 192.168.1.128/27
        [G9R]  G8     
          |
          |
         145   146   147
      ----+-----+-----+------------------------------ 192.168.1.144/27
             [G10R]   G9 
                |
                |
               161   162
            ----+-----+------------------------------ 192.168.1.160/27
                    G10
 


```
