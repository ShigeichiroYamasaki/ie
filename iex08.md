# インターネット工学演習 08

## 第８回 静的経路制御

前回の続き


|  ルータ  |  eth0  |
| ---- | ---- |
|G1|192.168.1.19
|G1R|192.168.1.4|
|G2|192.168.1.35|
|G2R|192.168.1.18|
|G3|192.168.1.50|
|G3R|192.168.1.34|
|G4|192.168.1.67|
|G4R|192.168.1.3|
|G5|192.168.1.83|
|G5R|192.168.1.66|
|G6|192.168.1.99|
|G6R|192.168.1.82|
|G7|192.168.1.114|
|G7R|192.168.1.98|
|G8|192.168.1.131|
|G8R|192.168.1.2|
|G9|192.168.1.147|
|G9R|192.168.1.130|
|G10|192.168.1.162|
|G10R|192.168.1.146|

### ip route コマンドによるルーティングテーブルの確認

```
ip route
```

### ip route コマンドによるルーティングテーブルの追加

```
sudo ip route add 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース名
```

例

```
ip rroute add 192.168.0.240/28 via 192.168.226 dev enx8857ee65561c
```

### 間違っているルーティングテーブルの削除

ip route del コマンドの文法

```bash
sudo ip route del 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース
```

例

```bash
sudo ip route del 192.168.0.112/28 via 192.168.0.98 dev enx8857ee65781e
```

### 6セグメント（８セグメント）の例（第３段階）

★サブネットマスクが27ビットになっていることに注意！

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18    19  
--+-------+-------+-------+----+-----+--------------- 192.168.1.0/27
[G8R]   [G4R]   [G1R]        [G2R]  G1   
  |       |       |            |  
  |       |      17            |   
  |       |                    |
  |       |                    33    34    35    50   
  |       |                 ---+-----+-----+-----+--- 192.168.1.32/27
  |       |                        [G3R]   G2    G3     
  |       |                          |
  |       |                         49
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/27
  |           [G5R]   G4  [G6R]   G5     
  |             |           |
  |            81           |
  |                         |
  |                         97    98    99   114  
  |                    -----+-----+-----+-----+------ 192.168.1.96/27
  |                             [G7R]   G6    G7   
  |                               |
  |                             113
  |
 129     130   131   146   147  
--+-------+-----+-----+-----+------------------------ 192.168.1.128/27
        [G9R]  G8  [G10R]   G9    
          |          |
        145          |
                     |
                    161   162
                 ----+-----+------------------------- 192.168.1.160/27
                          G10
 


```

## ルーティングテーブルを書いてください（担当ルータ以外も）

* G8R
* G4R
* G2R
* G6R
* G10R

```
ルータG8R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG4R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG2R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG6R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```

```
ルータG10R
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
192.168.0.0/24 		|				|
192.168.1.0/27		|				|
192.168.1.32/27		|				|
192.168.1.64/27		|				|
192.168.1.96/27		|				|
192.168.1.128/27	|				|
192.168.1.160/27	|				|
デフォルト        |				 |
```



## 　山崎が物理的に接続を変更しました（先週）

## ルーティングテーブルが設定されていない状態でマシンにログインする方法

* まず，ルーティングが定義されているルータにssh ログインします。
* そこから直接接続されているネットワークのマシンに ssh ログインします。

### netplan のサブネット設定を修正する

#### ★　G3R, G2, G3へ ssh ログインするためには，まず G2R にssh ログインする必要があります。

#### ★　G7R, G6, G7へ ssh ログインするためには，まず G6R にssh ログインする必要があります。

#### ★　G10へ ssh ログインするためには，まず G10R にssh ログインする必要があります。

## ルーティングテーブルの設定に成功していることを確認する

- ping コマンド
- traceroute コマンド


### 11セグメント（16セグメント）の例（第４段階）

★サブネットマスクが27ビットと28ビットになっていることに注意！

```
                                     Internet
                                         |
                        253              1           
    ----------------------+--------------+----------- 192.168.0.0/24
                      [ router1 ](SSH)
                          |
                          |
  2       3       4       1    18     
--+-------+-------+-------+----+--------------------- 192.168.1.0/28
[G8R]   [G4R]   [G1R]          
  |       |       |
  |       |       |
  |       |       17          18    19
  |       |      -+------------+-----+--------------- 192.168.16.0/28
  |       |                  [G2R]  G1 
  |       |                    |
  |       |                    |
  |       |                   33    34    35    
  |       |                 ---+-----+-----+--------- 192.168.1.32/28
  |       |                        [G3R]   G2      
  |       |                          |
  |       |                          |
  |       |                         49    50   
  |       |   -----------------------+-----+--------- 192.168.1.48/28
  |       |                               G3     
  |       |
  |       |
  |       65    66    67    82    83     
  |     --+-----+-----+-----+-----+------------------ 192.168.1.64/28
  |           [G5R]   G4    
  |             |
  |             |
  |            81          82
  |           --+-----------+-----+------------------ 192.168.1.80/28
  |                       [G6R]   G5  
  |                         |
  |                         |
  |                         97    98    99
  |                    -----+-----+-----+------------ 192.168.1.96/28
  |                             [G7R]  G6 
  |                               |
  |                               |
  |                              113   114  
  |                            ---+-----+------------ 192.168.1.112/28
  |                                    G7   
  |
  |
 129     130   131   
--+-------+-----+------------------------------------ 192.168.1.128/27
        [G9R]  G8     
          |
          |
         145   146   147
      ----+-----+-----+------------------------------ 192.168.1.144/27
             [G10R]   G9 
                |
                |
               161   162
            ----+-----+------------------------------ 192.168.1.160/27
                    G10
 


```


## ルーティングテーブルを書いてください

* G1R
* G2R
* G3R
* G4R
* G5R
* G6R
* G7R
* G8R
* G9R
* G10R

```
ルータ名
宛先ネットワーク／サブネット｜　ゲートウェイ　　｜　インターフェース
-------------------------------------------------------------------------------------------------
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		|				|
                 		

```


### netplan の設定を修正する


## ip route コマンドによるルーティングテーブルの確認

```
ip route
```

## ip route コマンドによるルーティングテーブルの追加

```
sudo ip route add 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース名
```

例

```
ip rroute add 192.168.0.240/28 via 192.168.226 dev enx8857ee65561c
```

### 間違っているルーティングテーブルの削除

ip route del コマンドの文法

```bash
sudo ip route del 宛先ネットワーク/サブネット via ゲートウェー dev インターフェース
```

例

```bash
sudo ip route del 192.168.0.112/28 via 192.168.0.98 dev enx8857ee65781e
```




